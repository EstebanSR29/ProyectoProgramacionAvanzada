@model List<ProyectoG6.BaseDatos.MostrarProductos_Result>

@{
    ViewBag.Title = "MostrarProductos";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="text-center my-4">Catálogo de Productos</h2>

<div class="container">
    <a href="@Url.Action("AgregarProducto", "Home")" class="btn btn-success btn-sm mb-4 d-block">Agregar Producto</a>
    <div class="row">
        @foreach (var item in Model)
        {
            <div class="col-md-3 mb-4">
                <div class="card">
                    <img src="@item.Imagen" class="card-img-top" alt="@item.Nombre" style="height: 200px; object-fit: cover;">
                    <div class="card-body">
                        <h5 class="card-title">@item.Nombre</h5>
                        <p class="card-text">₡ @item.Precio</p>
                        <p class="card-text"><small class="text-muted">Categoría: @item.Categoria</small></p>
                        <p class="card-text">Inventario: @item.Inventario</p>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <a href="@Url.Action("ActualizarProducto", "Home", new {IdProducto=item.IdProducto})" class="btn btn-warning btn-sm me-2" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="@Url.Action("EliminarProducto", "Home", new {IdProducto=item.IdProducto})" class="btn btn-danger btn-sm" title="Eliminar" onclick="return confirm('¿Estás seguro de que deseas eliminar este producto?');">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                            </div>
                        </div>
                        @if (item.Inventario > 0)
                        {
                            <div class="d-flex flex-column flex-sm-row align-items-center">
                                <input id="prd-@item.IdProducto" type="number" class="form-control mb-2 mb-sm-0 me-2" style="width: 100px; max-width: 100px; text-align: center;" value="0" min="1" max="@item.Inventario"
                                       onkeypress="return ValidarNumeros(this.id)">
                                <a onclick="AgregarProducto(@item.IdProducto, @item.Inventario);" class="btn btn-primary btn-md text-white px-3 py-2" style="transition: background-color 0.3s, transform 0.3s; border-radius: 4px;"
                                   onmouseover="this.style.backgroundColor='#0056b3'; this.style.transform='scale(1.05)';"
                                   onmouseout="this.style.backgroundColor='#007bff'; this.style.transform='scale(1)';">
                                    Añadir al Carrito
                                </a>
                            </div>
                        }
                        else
                        {
                            <div class="mt-3">
                                <p class="text-danger font-weight-bold" style="font-size:12pt;">Agotado</p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>



<script>

    function ValidarNumeros(evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode;

        if (charCode >= 48 && charCode <= 57) {
            return true;
        }
        else {
            return false;
        }
    }

    function AgregarProducto(IdProducto, Inventario) {


        let cantidadIngresada = $("#prd-" + IdProducto).val();


        if (cantidadIngresada > Inventario || cantidadIngresada <= 0) {
            MostrarMensaje("¡Cantidad inválida!", "Ingrese una cantidad mayor a 0 y menor o igual a " + Inventario, "warning");
            return;
        }

        $.ajax({
            type: 'POST',
            url: '/Login/RegistrarCarrito',
            dataType: 'json',
            data: {
                "IdProducto": IdProducto,
                "Cantidad": cantidadIngresada
            },
            success: function (data) {
                MostrarMensaje("¡Añadido!", "Producto añadido al carrito", "success");
            }
        });

    }

    function MostrarMensaje(titulo, mensaje, icono) {

        Swal.fire({
            title: titulo,
            showDenyButton: false,
            showCancelButton: false,
            confirmButtonText: "Aceptar",
            text: mensaje,
            icon: icono
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/Home/MostrarProductos';
            }
        });

    }

</script>